#!/bin/bash

echo "üöÄ –ü—Ä—è–º–æ–π –¥–µ–ø–ª–æ–π –Ω–∞ Vercel (–±–µ–∑ Git)"

# –ü—Ä–æ–≤–µ—Ä—è–µ–º Vercel CLI
if ! command -v vercel &> /dev/null; then
    echo "üì¶ –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º Vercel CLI..."
    npm install -g vercel
fi

# –û—á–∏—â–∞–µ–º –∫—ç—à
echo "üßπ –û—á–∏—â–∞–µ–º –∫—ç—à..."
rm -rf node_modules .next package-lock.json

# –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
echo "üì¶ –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏..."
npm install

# –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å–±–æ—Ä–∫—É –ª–æ–∫–∞–ª—å–Ω–æ
echo "üîç –¢–µ—Å—Ç–∏—Ä—É–µ–º —Å–±–æ—Ä–∫—É –ª–æ–∫–∞–ª—å–Ω–æ..."
npm run build

if [ $? -eq 0 ]; then
    echo "‚úÖ –õ–æ–∫–∞–ª—å–Ω–∞—è —Å–±–æ—Ä–∫–∞ —É—Å–ø–µ—à–Ω–∞!"
    
    # –î–µ–ø–ª–æ–∏–º –Ω–∞ Vercel
    echo "üöÄ –î–µ–ø–ª–æ–∏–º –Ω–∞ Vercel..."
    vercel --prod
    
    echo "üéâ –î–µ–ø–ª–æ–π –∑–∞–≤–µ—Ä—à—ë–Ω!"
else
    echo "‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –ª–æ–∫–∞–ª—å–Ω–æ–π —Å–±–æ—Ä–∫–µ. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –≤—ã—à–µ."
    exit 1
fi
